<!doctype html>
<html lang="ja">
  <head>
    <!-- 文字コードを指定するコメント -->
    <meta charset="utf-8" />
    <!-- 表示領域を設定するコメント -->
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <!-- ページタイトルを指定するコメント -->
    <title>ヒカキン最新情報bot稼働状況</title>
    <!-- フォントを読み込むためのコメント -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <!-- フォント読み込みの接続先を許可するコメント -->
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <!-- フォントのスタイルを読み込むコメント -->
    <link
      href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;600;700&family=Zen+Kaku+Gothic+New:wght@400;700&display=swap"
      rel="stylesheet"
    />
    <!-- 画面デザインのスタイルを定義するコメント -->
    <style>
      /* カラーパレットを定義するコメント */
      :root {
        --ink: #0b0f1f;
        --ink-soft: #191f33;
        --surface: #ffffff;
        --surface-soft: #f4f1ea;
        --accent: #e56b6f;
        --accent-strong: #c44536;
        --teal: #2a9d8f;
        --sun: #f4a261;
        --shadow: 0 16px 50px rgba(11, 15, 31, 0.15);
      }

      /* 全体のレイアウトを整えるコメント */
      * {
        box-sizing: border-box;
      }

      /* 背景と文字の基本設定を行うコメント */
      body {
        margin: 0;
        font-family: "Zen Kaku Gothic New", "Space Grotesk", sans-serif;
        color: var(--ink);
        background: radial-gradient(circle at top, #fef6e6, #f4ede0 45%, #f0e2d2 100%);
        min-height: 100vh;
        overflow-x: hidden;
      }

      /* 背景装飾のレイヤーを配置するコメント */
      .ambient {
        position: fixed;
        inset: 0;
        background: radial-gradient(circle at 20% 20%, rgba(42, 157, 143, 0.16), transparent 55%),
          radial-gradient(circle at 80% 30%, rgba(229, 107, 111, 0.2), transparent 55%),
          radial-gradient(circle at 30% 80%, rgba(244, 162, 97, 0.18), transparent 60%);
        pointer-events: none;
        z-index: 0;
      }

      /* レイアウトの幅を制御するコメント */
      .page {
        position: relative;
        z-index: 1;
        max-width: 1100px;
        margin: 0 auto;
        padding: 48px 24px 80px;
        display: flex;
        flex-direction: column;
        gap: 32px;
      }

      /* ヘッダー部分のデザインを設定するコメント */
      .hero {
        background: var(--surface);
        border-radius: 28px;
        padding: 32px 36px;
        box-shadow: var(--shadow);
        display: flex;
        flex-direction: column;
        gap: 12px;
        animation: fadeUp 0.8s ease both;
      }

      /* タイトル行を整えるコメント */
      .hero-title {
        display: flex;
        align-items: center;
        gap: 16px;
      }

      /* タイトルバッジを装飾するコメント */
      .hero-badge {
        font-family: "Space Grotesk", sans-serif;
        font-size: 12px;
        letter-spacing: 0.16em;
        text-transform: uppercase;
        padding: 6px 12px;
        border-radius: 999px;
        background: var(--ink);
        color: #fff;
      }

      /* タイトルの見た目を調整するコメント */
      .hero h1 {
        margin: 0;
        font-size: clamp(28px, 4vw, 40px);
      }

      /* サブテキストのスタイルを設定するコメント */
      .hero p {
        margin: 0;
        color: #444b63;
        line-height: 1.6;
      }

      /* ステータスカードのレイアウトを整えるコメント */
      .status-card {
        background: linear-gradient(120deg, #ffffff 0%, #fdf1e6 100%);
        border-radius: 24px;
        padding: 28px 32px;
        box-shadow: var(--shadow);
        display: grid;
        gap: 20px;
        animation: fadeUp 0.8s ease 0.1s both;
      }

      /* ステータスの主要行を整えるコメント */
      .status-main {
        display: flex;
        align-items: center;
        gap: 16px;
      }

      /* ステータスのインジケーターを作るコメント */
      .status-dot {
        width: 18px;
        height: 18px;
        border-radius: 50%;
        background: #9aa0aa;
        box-shadow: 0 0 0 8px rgba(154, 160, 170, 0.15);
        animation: pulse 1.6s ease-in-out infinite;
      }

      /* ステータスのラベルを調整するコメント */
      .status-label {
        font-size: 12px;
        letter-spacing: 0.08em;
        color: #6c7285;
        margin: 0;
      }

      /* ステータスのテキストを設定するコメント */
      #status-text {
        margin: 4px 0 0;
        font-size: clamp(22px, 3vw, 30px);
        font-weight: 700;
      }

      /* ステータスの補足テキストを設定するコメント */
      #status-hint {
        margin: 0;
        color: #535a6b;
        line-height: 1.5;
      }

      /* ステータスの補足情報を並べるコメント */
      .status-meta {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
        gap: 12px;
        font-size: 14px;
      }

      /* ステータスの操作ボタンを整えるコメント */
      .status-actions {
        display: flex;
        flex-wrap: wrap;
        gap: 12px;
      }

      /* ボタンの共通スタイルを設定するコメント */
      .btn {
        border: none;
        border-radius: 999px;
        padding: 10px 18px;
        font-family: "Space Grotesk", sans-serif;
        font-weight: 600;
        letter-spacing: 0.04em;
        cursor: pointer;
        transition: transform 0.2s ease, box-shadow 0.2s ease;
      }

      /* ボタンのホバー時の動きを設定するコメント */
      .btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 12px 24px rgba(11, 15, 31, 0.18);
      }

      /* 稼働中ボタンの色を設定するコメント */
      .btn-running {
        background: var(--teal);
        color: #fff;
      }

      /* 注意ボタンの色を設定するコメント */
      .btn-warning {
        background: var(--sun);
        color: #2c1b11;
      }

      /* 停止ボタンの色を設定するコメント */
      .btn-stopped {
        background: var(--accent);
        color: #fff;
      }

      /* 情報カードのグリッドを作るコメント */
      .grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
        gap: 20px;
      }

      /* 情報カードのデザインを整えるコメント */
      .info-card {
        background: var(--surface);
        border-radius: 22px;
        padding: 22px 24px;
        box-shadow: var(--shadow);
        display: flex;
        flex-direction: column;
        gap: 8px;
        animation: fadeUp 0.8s ease 0.2s both;
      }

      /* カード内のラベルを調整するコメント */
      .info-label {
        font-size: 12px;
        letter-spacing: 0.12em;
        text-transform: uppercase;
        color: #7a8195;
      }

      /* カード内の値を強調するコメント */
      .info-value {
        font-size: 20px;
        font-weight: 700;
      }

      /* 補足テキストのスタイルを設定するコメント */
      .info-sub {
        font-size: 13px;
        color: #6c7285;
      }

      /* メモ入力エリアの見た目を整えるコメント */
      .note-area {
        display: flex;
        flex-direction: column;
        gap: 12px;
      }

      /* テキストエリアのスタイルを設定するコメント */
      textarea {
        width: 100%;
        min-height: 120px;
        border-radius: 16px;
        border: 1px solid #e3d8c9;
        padding: 14px 16px;
        font-family: "Zen Kaku Gothic New", sans-serif;
        font-size: 14px;
        background: #fffaf4;
        resize: vertical;
      }

      /* フッターのデザインを調整するコメント */
      footer {
        text-align: center;
        color: #6c7285;
        font-size: 12px;
      }

      /* 稼働ステータスの色分けを設定するコメント */
      .status-running .status-dot {
        background: var(--teal);
        box-shadow: 0 0 0 8px rgba(42, 157, 143, 0.18);
      }

      /* 注意ステータスの色分けを設定するコメント */
      .status-warning .status-dot {
        background: var(--sun);
        box-shadow: 0 0 0 8px rgba(244, 162, 97, 0.22);
      }

      /* 停止ステータスの色分けを設定するコメント */
      .status-stopped .status-dot {
        background: var(--accent-strong);
        box-shadow: 0 0 0 8px rgba(196, 69, 54, 0.2);
      }

      /* アニメーションの定義を行うコメント */
      @keyframes fadeUp {
        from {
          opacity: 0;
          transform: translateY(16px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      /* パルスアニメーションの定義を行うコメント */
      @keyframes pulse {
        0%,
        100% {
          transform: scale(1);
        }
        50% {
          transform: scale(1.08);
        }
      }

      /* モバイル表示の調整を行うコメント */
      @media (max-width: 640px) {
        .hero {
          padding: 24px;
        }

        .status-card {
          padding: 24px;
        }
      }

      /* 動きを控えたい場合の設定を行うコメント */
      @media (prefers-reduced-motion: reduce) {
        * {
          animation: none !important;
          transition: none !important;
        }
      }
    </style>
  </head>
  <body>
    <!-- 背景装飾レイヤーを配置するコメント -->
    <div class="ambient"></div>

    <!-- ページ全体のコンテナを配置するコメント -->
    <div class="page">
      <!-- ヘッダーセクションを配置するコメント -->
      <header class="hero">
        <!-- タイトル行をまとめるコメント -->
        <div class="hero-title">
          <!-- タイトルバッジを表示するコメント -->
          <span class="hero-badge">STATUS</span>
          <!-- メインタイトルを表示するコメント -->
          <h1>X-Hikakin-bot 稼働状況モニター</h1>
        </div>
        <!-- 説明文を表示するコメント -->
        <p>
          Twitchコメント監視とX投稿の稼働状況を、ローカルAPIから自動取得して表示するダッシュボードです。
          APIが停止している場合は未接続として表示されます。
        </p>
      </header>

      <!-- ステータス表示カードを配置するコメント -->
      <section class="status-card" id="status-card" data-status="unknown">
        <!-- ステータスのメイン表示をまとめるコメント -->
        <div class="status-main">
          <!-- ステータスインジケーターを表示するコメント -->
          <div class="status-dot" aria-hidden="true"></div>
          <!-- ステータスの文言を表示するコメント -->
          <div>
            <!-- ラベルを表示するコメント -->
            <p class="status-label" id="status-label">現在の稼働状態</p>
            <!-- 状態のテキストを表示するコメント -->
            <h2 id="status-text">未確認</h2>
          </div>
        </div>
        <!-- ステータスの補足説明を表示するコメント -->
        <p id="status-hint">状態ボタンを押して、稼働状況を記録してください。</p>

        <!-- ステータスの詳細情報を並べるコメント -->
        <div class="status-meta">
          <!-- 最終更新時刻を表示するコメント -->
          <div>最終更新: <strong id="status-updated">--</strong></div>
          <!-- API接続状態を表示するコメント -->
          <div>API接続: <strong id="api-status">未接続</strong></div>
          <!-- 現在時刻を表示するコメント -->
          <div>現在時刻: <strong id="now-clock">--</strong></div>
          <!-- 稼働時間を表示するコメント -->
          <div>稼働時間: <strong id="uptime">--</strong></div>
        </div>

      </section>

      <!-- 情報カードのグリッドを配置するコメント -->
      <section class="grid">
        <!-- 監視チャンネルの情報カードを配置するコメント -->
        <article class="info-card">
          <!-- ラベルを表示するコメント -->
          <span class="info-label">監視チャンネル</span>
          <!-- 値を表示するコメント -->
          <span class="info-value" id="twitch-channel">--</span>
          <!-- 補足説明を表示するコメント -->
          <span>IRCでコメント監視中</span>
        </article>

        <!-- 投稿対象ユーザーの情報カードを配置するコメント -->
        <article class="info-card">
          <!-- ラベルを表示するコメント -->
          <span class="info-label">投稿対象</span>
          <!-- 値を表示するコメント -->
          <span class="info-value" id="target-user">--</span>
          <!-- 補足説明を表示するコメント -->
          <span>大文字小文字を吸収して投稿</span>
        </article>

        <!-- 最終コメントの情報カードを配置するコメント -->
        <article class="info-card">
          <!-- ラベルを表示するコメント -->
          <span class="info-label">最終コメント</span>
          <!-- 値を表示するコメント -->
          <span class="info-value" id="last-comment-user">--</span>
          <!-- コメント本文を表示するコメント -->
          <span class="info-sub" id="last-comment-text">--</span>
          <!-- コメント時刻を表示するコメント -->
          <span class="info-sub" id="last-comment-time">--</span>
        </article>

        <!-- 最終投稿の情報カードを配置するコメント -->
        <article class="info-card">
          <!-- ラベルを表示するコメント -->
          <span class="info-label">最終投稿</span>
          <!-- 値を表示するコメント -->
          <span class="info-value" id="last-post-time">--</span>
          <!-- 投稿本文を表示するコメント -->
          <span class="info-sub" id="last-post-text">--</span>
        </article>

        <!-- 最終エラーの情報カードを配置するコメント -->
        <article class="info-card">
          <!-- ラベルを表示するコメント -->
          <span class="info-label">最終エラー</span>
          <!-- 値を表示するコメント -->
          <span class="info-value" id="last-error-time">--</span>
          <!-- エラー内容を表示するコメント -->
          <span class="info-sub" id="last-error-text">--</span>
        </article>

        <!-- X連携の情報カードを配置するコメント -->
        <article class="info-card">
          <!-- ラベルを表示するコメント -->
          <span class="info-label">X連携</span>
          <!-- 値を表示するコメント -->
          <span class="info-value">手動確認</span>
          <!-- 補足説明を表示するコメント -->
          <span>投稿はAPIで実施</span>
        </article>

        <!-- 動作モードの情報カードを配置するコメント -->
        <article class="info-card">
          <!-- ラベルを表示するコメント -->
          <span class="info-label">動作モード</span>
          <!-- 値を表示するコメント -->
          <span class="info-value">認証モード</span>
          <!-- 補足説明を表示するコメント -->
          <span>リフレッシュトークン利用</span>
        </article>
      </section>

      <!-- メモ入力エリアを配置するコメント -->
      <section class="info-card note-area">
        <!-- ラベルを表示するコメント -->
        <span class="info-label">メモ</span>
        <!-- 入力欄の説明を表示するコメント -->
        <strong>直近の状況や気づきを残す</strong>
        <!-- メモ入力用のテキストエリアを配置するコメント -->
        <textarea id="memo" placeholder="例: 04:20に起動、コメント流量増加"></textarea>
        <!-- メモの保存状況を表示するコメント -->
        <span id="memo-status">未保存</span>
      </section>

      <!-- フッターを配置するコメント -->
      <footer>ローカル表示専用 / 更新操作はこのページ内で完結します。</footer>
    </div>

    <!-- 挙動を制御するスクリプトを配置するコメント -->
    <script>
      // 状態を保存するキーを定義するコメント
      const STORAGE_KEYS = {
        status: "xhikakin-status",
        updated: "xhikakin-status-updated",
        memo: "xhikakin-memo",
      };

      // 状態ごとの表示情報を定義するコメント
      const STATUS_MAP = {
        running: { label: "稼働中", hint: "監視と投稿が動作中です。" },
        warning: { label: "注意", hint: "エラーや遅延が発生している可能性があります。" },
        stopped: { label: "停止", hint: "プロセスが停止しています。" },
        unknown: { label: "未確認", hint: "状態ボタンで更新してください。" },
      };

      // DOM要素を取得するコメント
      const statusCard = document.getElementById("status-card");
      const statusText = document.getElementById("status-text");
      const statusHint = document.getElementById("status-hint");
      const statusUpdated = document.getElementById("status-updated");
      const nowClock = document.getElementById("now-clock");
      const uptime = document.getElementById("uptime");
      const memoField = document.getElementById("memo");
      const memoStatus = document.getElementById("memo-status");
      const actionButtons = document.querySelectorAll("[data-status]");

      // ページが開かれた時刻を記録するコメント
      const startTime = Date.now();

      // 日時を整形する関数に関するコメント
      const formatDateTime = (date) =>
        `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, "0")}-${String(
          date.getDate(),
        ).padStart(2, "0")} ${String(date.getHours()).padStart(2, "0")}:${String(
          date.getMinutes(),
        ).padStart(2, "0")}:${String(date.getSeconds()).padStart(2, "0")}`;

      // 稼働時間を整形する関数に関するコメント
      const formatUptime = (millis) => {
        const totalSeconds = Math.floor(millis / 1000);
        const hours = String(Math.floor(totalSeconds / 3600)).padStart(2, "0");
        const minutes = String(Math.floor((totalSeconds % 3600) / 60)).padStart(2, "0");
        const seconds = String(totalSeconds % 60).padStart(2, "0");
        return `${hours}:${minutes}:${seconds}`;
      };

      // 状態表示を更新する関数に関するコメント
      const applyStatus = (statusKey, updatedAt) => {
        const safeKey = STATUS_MAP[statusKey] ? statusKey : "unknown";
        const { label, hint } = STATUS_MAP[safeKey];

        statusCard.classList.remove("status-running", "status-warning", "status-stopped");
        if (safeKey === "running") {
          statusCard.classList.add("status-running");
        } else if (safeKey === "warning") {
          statusCard.classList.add("status-warning");
        } else if (safeKey === "stopped") {
          statusCard.classList.add("status-stopped");
        }

        statusText.textContent = label;
        statusHint.textContent = hint;
        statusUpdated.textContent = updatedAt ? formatDateTime(new Date(updatedAt)) : "--";
      };

      // ステータスを保存する関数に関するコメント
      const saveStatus = (statusKey) => {
        const updatedAt = Date.now();
        localStorage.setItem(STORAGE_KEYS.status, statusKey);
        localStorage.setItem(STORAGE_KEYS.updated, String(updatedAt));
        applyStatus(statusKey, updatedAt);
      };

      // 現在時刻と稼働時間を更新する関数に関するコメント
      const updateClocks = () => {
        nowClock.textContent = formatDateTime(new Date());
        uptime.textContent = formatUptime(Date.now() - startTime);
      };

      // メモの保存を行う関数に関するコメント
      const saveMemo = () => {
        localStorage.setItem(STORAGE_KEYS.memo, memoField.value);
        memoStatus.textContent = "保存済み";
      };

      // 初期状態を読み込む処理に関するコメント
      const loadInitialState = () => {
        const storedStatus = localStorage.getItem(STORAGE_KEYS.status) || "unknown";
        const storedUpdated = Number(localStorage.getItem(STORAGE_KEYS.updated)) || 0;
        const storedMemo = localStorage.getItem(STORAGE_KEYS.memo) || "";

        applyStatus(storedStatus, storedUpdated || null);
        memoField.value = storedMemo;
        memoStatus.textContent = storedMemo ? "保存済み" : "未保存";
      };

      // ボタン操作を紐づけるコメント
      actionButtons.forEach((button) => {
        if (!(button instanceof HTMLButtonElement)) {
          return;
        }
        button.addEventListener("click", () => {
          const status = button.getAttribute("data-status");
          if (status) {
            saveStatus(status);
          }
        });
      });

      // メモの入力を監視するコメント
      memoField.addEventListener("input", () => {
        memoStatus.textContent = "未保存";
      });

      // メモのフォーカスアウトで保存するコメント
      memoField.addEventListener("blur", saveMemo);

      // 初期状態を反映するコメント
      loadInitialState();
      updateClocks();
      setInterval(updateClocks, 1000);
    </script>
  </body>
</html>
